{"version":3,"file":"context-menu-plugin.min.js","sources":["../src/utils.js","../src/menu/debounceHide.js","../src/menu/index.js","../src/main-menu.js","../src/node-menu.js","../src/index.js"],"sourcesContent":["export function deepCopy(obj) {\r\n    return JSON.parse(JSON.stringify(obj));\r\n}\r\n\r\nexport async function createNode(component, { data = {}, meta = {}, x = 0, y = 0 }) {\r\n    const node = await component.createNode(deepCopy(data));\r\n\r\n    node.meta = Object.assign(deepCopy(meta), node.meta);\r\n    node.position[0] = x;\r\n    node.position[1] = y;\r\n    \r\n    return node;\r\n}\r\n\r\nexport function traverse(items, callback, path = []) {\r\n    if (typeof items !== 'object') return;\r\n\r\n    Object.keys(items).map(key => {\r\n        if (typeof items[key] === 'function')\r\n            callback(key, items[key], path)\r\n        else \r\n            traverse(items[key], callback, [...path, key])\r\n    })\r\n}\r\n\r\nexport function fitViewport([x, y], element) {\r\n    return [\r\n        Math.min(x, window.innerWidth - element.clientWidth),\r\n        Math.min(y, window.innerHeight - element.clientHeight)\r\n    ]\r\n}\r\n\r\n// Cloneを外部から実行できる\r\nexport async function cloneNode(editor, node, isTrigger) {\r\n    const { name, position: [x, y], ...params } = node;\r\n    const component = editor.components.get(name);\r\n    const nodeFromClone = await createNode(component, { ...params, x: x + 10, y: y + 10 });\r\n\r\n    editor.addNode(nodeFromClone);\r\n    \r\n    const obj = { \r\n      node: node,\r\n      nodeFromClone: nodeFromClone,\r\n    };\r\n    \r\n    if (isTrigger) { // トリガーを無効化することでイベント内でさらにクローンしたとき無限ループを防げる\r\n      editor.trigger('nodeclone', obj);\r\n    }\r\n}","import { debounce } from 'lodash-es';\r\n\r\nexport default (hideMethod) => ({\r\n    props: { delay: { type: Number, required: true } },\r\n    data() {\r\n        return {\r\n            timeoutHide: () => {}\r\n        }\r\n    },\r\n    methods: {\r\n        cancelHide() {\r\n            const hide = this.timeoutHide;\r\n    \r\n            if (hide && hide.cancel)\r\n                this.timeoutHide.cancel();\r\n        }\r\n    },\r\n    mounted() {\r\n        this.timeoutHide = debounce(this[hideMethod], this.delay);\r\n    }\r\n})","import Menu from './Menu.vue';\r\nimport Vue from 'vue';\r\n\r\nexport default class {\r\n    \r\n    constructor(editor, props, vueComponent) {\r\n        const el = document.createElement('div');\r\n\r\n        editor.view.container.appendChild(el);\r\n\r\n        this.menu = new Vue({\r\n            render: h => h(vueComponent || Menu, { props })\r\n        }).$mount(el);\r\n    }\r\n\r\n    addItem(...args) {\r\n        this.menu.$emit('additem', ...args);\r\n    }\r\n\r\n    show(...args) {\r\n        this.menu.$emit('show', ...args);\r\n    }\r\n\r\n    hide() {\r\n        this.menu.$emit('hide');\r\n    }\r\n}","import { createNode, traverse } from './utils';\r\nimport Menu from './menu/index';\r\n\r\nexport default class MainMenu extends Menu {\r\n    constructor(editor, props, vueComponent, { items, allocate, rename }) {\r\n        super(editor, props, vueComponent);\r\n        \r\n        const mouse = { x: 0, y: 0 };\r\n\r\n        editor.on('mousemove', ({ x, y }) => {\r\n            mouse.x = x;\r\n            mouse.y = y;\r\n        });\r\n        \r\n        for (const component of editor.components.values()) {\r\n            const path = allocate(component);\r\n    \r\n            if (Array.isArray(path)) { // add to the menu if path is array\r\n                this.addItem(rename(component), async () => {\r\n                    editor.addNode(await createNode(component, mouse));\r\n                }, path);\r\n            }\r\n        }\r\n    \r\n        traverse(items, (name, func, path) => this.addItem(name, func, path))\r\n    }\r\n}","import Menu from './menu/index';\r\n// import { createNode, traverse, cloneNode } from './utils';\r\nimport { traverse, cloneNode } from './utils';\r\n\r\nexport default class NodeMenu extends Menu {\r\n    constructor(editor, props, vueComponent, nodeItems, renameNodeMenu) {\r\n        super(editor, props, vueComponent);\r\n\r\n        if (nodeItems['Delete'] !== false) {\r\n            this.addItem(renameNodeMenu('Delete'), ({ node }) => editor.removeNode(node));\r\n        }\r\n        if (nodeItems['Clone'] !== false) {\r\n            this.addItem(renameNodeMenu('Clone'), async (args) => {\r\n                // const { name, position: [x, y], ...params } = args.node;\r\n                // const component = editor.components.get(name);\r\n                // const node = await createNode(component, { ...params, x: x + 10, y: y + 10 });\r\n\r\n                // editor.addNode(node);\r\n                \r\n                // editor.trigger('nodeclone', node);\r\n                cloneNode(editor, args.node, true);\r\n            });\r\n        }\r\n\r\n        traverse(nodeItems, (name, func, path) => this.addItem(renameNodeMenu(name), func, path))\r\n    }\r\n}\r\n","import MainMenu from './main-menu';\r\nimport NodeMenu from './node-menu';\r\nimport VueItem from './menu/Item.vue';\r\nimport VueMenu from './menu/Menu.vue';\r\nimport VueSearch from './menu/Search.vue';\r\nimport { isFunction } from 'lodash-es';\r\nimport { cloneNode } from './utils';\r\n\r\nfunction install(editor, {\r\n    searchBar = true,\r\n    searchKeep = () => false,\r\n    delay = 1000,\r\n    items = {},\r\n    nodeItems = {},\r\n    allocate = () => [],\r\n    rename = component => component.name,\r\n    renameNodeMenu = name => name,\r\n    vueComponent = null\r\n}) {\r\n    editor.bind('hidecontextmenu');\r\n    editor.bind('showcontextmenu');\r\n    editor.bind('nodeclone');\r\n\r\n    let menu = null;\r\n\r\n    editor.on('hidecontextmenu', () => {\r\n        if (menu) menu.hide();\r\n    });\r\n\r\n    editor.on('click contextmenu', () => {\r\n        editor.trigger('hidecontextmenu');\r\n    });\r\n\r\n    editor.on('contextmenu', ({ e, node }) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        if (!editor.trigger('showcontextmenu', { e, node })) return;\r\n\r\n        const [x, y] = [e.clientX, e.clientY];\r\n\r\n        if (node) {\r\n            menu = new NodeMenu(editor, { searchBar: false, delay }, vueComponent, isFunction(nodeItems) ? nodeItems(node) : nodeItems, renameNodeMenu);\r\n            menu.show(x, y, { node });\r\n        } else {\r\n            menu = new MainMenu(editor, { searchBar, searchKeep, delay }, vueComponent, { items, allocate, rename });\r\n            menu.show(x, y);\r\n        }\r\n    });\r\n}\r\n\r\nexport const Menu = VueMenu;\r\nexport const Item = VueItem;\r\nexport const Search = VueSearch;\r\n\r\nexport default {\r\n    name: 'context-menu',\r\n    install,\r\n    cloneNode,\r\n}\r\n"],"names":["deepCopy","obj","JSON","parse","stringify","createNode","component","data","meta","x","y","node","Object","assign","position","traverse","items","callback","path","_typeof","keys","map","key","cloneNode","editor","isTrigger","name","params","components","get","nodeFromClone","addNode","trigger","hideMethod","props","delay","type","Number","required","timeoutHide","methods","cancelHide","hide","this","cancel","mounted","debounce","element","Math","min","window","innerWidth","clientWidth","innerHeight","clientHeight","vueComponent","el","document","createElement","view","container","appendChild","menu","Vue","render","h","Menu","$mount","args","$emit","MainMenu","allocate","rename","mouse","on","Array","isArray","addItem","values","func","_this","NodeMenu","nodeItems","renameNodeMenu","removeNode","VueMenu","Item","VueItem","Search","VueSearch","install","searchBar","searchKeep","bind","e","preventDefault","stopPropagation","clientX","clientY","isFunction","show"],"mappings":"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"}